class User < ActiveRecord::Base
  has_many :campaign_users
  has_many :campaigns, through: :campaign_users

  def self.find_or_create_with_omniauth(auth)
<<<<<<< HEAD
    user = find_by(uid: auth.slice(:uid).uid) || initialize_from_omniauth(auth)
    user.update_dynamic_attributes(auth)
=======
    puts auth.to_json
  	user = find_by(uid: auth.slice(:uid).uid) || initialize_from_omniauth(auth)
  	user.update_dynamic_attributes(auth)
>>>>>>> 7ee87a4e6dc6d6a387886a81d81e7af48013ba9b
  end

 def self.initialize_from_omniauth(auth)
 	new do |user|
 		user.provider = auth[:provider]
 		user.uid = auth[:uid]
 		user.name = auth[:info][:name]
    user.token = auth[:credentials][:token]
    user.token_secret = auth[:credentials][:secret]
    user.screen_name = auth[:extra][:raw_info][:screen_name]
 		user.save
 	end
 end

 def update_dynamic_attributes(auth)
 	self.location = auth[:info][:location] 
 	self.image = auth[:info][:image] 
 	self.description = auth[:info][:description]
  self.followers = auth[:extra][:raw_info][:followers_count]
  self.friends = auth[:extra][:raw_info][:friends_count]
  self.background_image = auth[:extra][:raw_info][:profile_banner_url] || "http://placehold.it/794x397"
  self.tweets = auth[:extra][:raw_info][:statuses_count]
 	self.save!
 	self
 end
end

